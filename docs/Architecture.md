# Архитектура сервера

## Обзор проекта

Проект представляет собой веб-приложение на базе PHP и MySQL, развернутое в Docker Swarm для обеспечения автоматического обновления. Архитектура разделена на продакшен и тестовую среды для безопасного тестирования изменений.

## Компоненты

### Сети
- **external**: Внешняя сеть для доступа извне (через Nginx).
- **prod_internal**: Внутренняя сеть для продакшен сервисов (MySQL, PHP).
- **test_internal**: Внутренняя сеть для тестовых сервисов (MySQL, PHP).

### Сервисы
- **nginx**: Reverse proxy на базе Nginx, слушает порт 80, маршрутизирует трафик на PHP сервисы.
- **php_prod**: PHP приложение для продакшена, подключено к базе `database_prod`.
- **php_test**: PHP приложение для тестирования, подключено к базе `database_test`.
- **database_prod**: MySQL база данных для продакшена.
- **database_test**: MySQL база данных для тестирования.
- **database_prod_backup**: Сервис для создания бэкапов продакшен базы (работает как job).

### Хранение данных
- **Volumes**: Используются для персистентного хранения данных БД, логов PHP и Nginx, а также бэкапов.
- **Secrets**: Хранятся пароли и конфиденциальные данные (root пароль, пользователь БД и т.д.).

## Развертывание
Проект развертывается с помощью Docker Swarm. Бэкапы выполняются автоматически через cron или сервис `database_prod_backup`.
